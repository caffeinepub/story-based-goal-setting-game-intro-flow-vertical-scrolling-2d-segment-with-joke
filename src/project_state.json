{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 52,
  "summary": "A React + TypeScript single-page app with a story-driven, multi-stage intro experience (timed narrative reveals, user-gated progression, and mood-darkening gradient transitions plus a slider-based question) that transitions into a small 2D top-down canvas game. In the game, the player moves a Donald pixel character through a narrow, strictly linear, downward-progressing corridor world with gentle curves, while a smooth camera follows; obstacles block movement via collisions with wall-sliding; pressing Space shows a random joke in a timed speech balloon overlay. The repo also includes scaffolding for Internet Identity authentication and identity-aware backend actor creation via React Query, plus a reusable build-template directory containing ICP canister configs, frontend tooling, shadcn/ui component set, and deploy/build scripts for packaging/export.",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Intro-to-game app flow switch",
      "synonyms": [
        "gameStarted toggle",
        "IntroFlow onComplete",
        "App conditional rendering"
      ],
      "description": "The top-level App component initially shows the IntroFlow narrative sequence and switches to the canvas GameView after IntroFlow calls onComplete.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "Centralized typed story content model",
      "synonyms": [
        "StoryStep model",
        "content/story.ts",
        "story configuration"
      ],
      "description": "Intro narrative copy and step metadata (opening lines, goal blocks, slider prompt, statistic step, Donald narrative blocks) are centralized in typed exports for consistent sequencing and rendering.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Stage-based intro state machine with gated progression",
      "synonyms": [
        "FlowStage union",
        "Continue gates",
        "Start stage"
      ],
      "description": "IntroFlow drives the intro via an explicit stage union, showing Continue/Start actions at specific points rather than auto-advancing the whole sequence.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Timed line-by-line narrative reveal with entrance animations",
      "synonyms": [
        "sequential reveal",
        "LINE_REVEAL_DELAY",
        "fade-in + slide-in"
      ],
      "description": "Intro text is revealed one line at a time using timers (1000ms cadence) and animated in using Tailwind animation classes to emphasize progression.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "Progressive intro background mood darkening via gradient crossfade",
      "synonyms": [
        "OKLCH gradient progression",
        "darkeningIndex",
        "getBackgroundGradient"
      ],
      "description": "As story steps marked with darkening are revealed, the background transitions from a light/fun gradient to darker, colder hues using a computed OKLCH gradient and a crossfaded two-layer background.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "Goal stickiness slider question with conditional feedback and delayed Continue",
      "synonyms": [
        "GoalStickinessQuestion",
        "1–100 slider",
        "feedback gating"
      ],
      "description": "A slider question accepts a 1–100% guess, shows conditional feedback (\"correct\" if 5–10%), then reveals a Continue button after a short delay; advancing requires explicit Continue.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Emphasized statistic stage with timed Continue gate",
      "synonyms": [
        "8% statistic",
        "stat emphasis"
      ],
      "description": "Displays an emphasized statistic message and then reveals a Continue button after the standard delay.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "Stage-specific Donald sprite in intro",
      "synonyms": [
        "donald-block-a image",
        "pixelated sprite"
      ],
      "description": "Shows the Donald pixel sprite only during the first Donald narrative block stages, using a pixelated rendering style for crisp pixel art.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Consistent CTA button styling across intro stages",
      "synonyms": [
        "pill-outline Continue buttons",
        "animated Start button"
      ],
      "description": "Continue/Submit CTAs share a pill-outline style while the \"Start now!\" CTA is presented as a distinct animated gradient button.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Centered canvas game view with instructions and footer",
      "synonyms": [
        "GameView layout",
        "game HUD text"
      ],
      "description": "Renders a 500×600 canvas in a centered layout with instruction text that changes based on whether the canvas is engaged, plus descriptive text and a footer link.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "Canvas-scoped keyboard controls with focus indicator",
      "synonyms": [
        "useKeyboardControls",
        "arrow keys movement",
        "Space action",
        "focus border"
      ],
      "description": "Arrow keys move the character and Space triggers an action only when the canvas is considered focused; the canvas shows a highlighted border when active and movement resets on blur.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "DeltaTime requestAnimationFrame game loop hook",
      "synonyms": [
        "useGameLoop",
        "RAF loop",
        "frame-independent update"
      ],
      "description": "Runs a requestAnimationFrame loop, computes deltaTime in seconds, and calls an onUpdate callback for frame-rate-independent simulation and rendering.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "World-space movement clamped to world bounds",
      "synonyms": [
        "top-down movement",
        "clampToWorldBounds"
      ],
      "description": "Moves the character in world coordinates at a constant pixels-per-second speed and clamps position so the player cannot leave the defined world rectangle.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Collision detection against map obstacles",
      "synonyms": [
        "checkCollision",
        "OBSTACLES"
      ],
      "description": "Detects rectangle-vs-obstacle overlap against a set of world obstacles (walls, rocks, trees).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "Collision resolution with wall-sliding",
      "synonyms": [
        "axis-separated resolution",
        "slide along walls",
        "reduced hitbox margin"
      ],
      "description": "Prevents passing through obstacles and attempts to resolve collisions by trying X-only movement then Y-only movement to create a smooth sliding feel.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Smooth camera follow with bounds clamping",
      "synonyms": [
        "Zelda-like camera",
        "camera smoothing",
        "camera bounds"
      ],
      "description": "A camera position follows the character with smoothing and is clamped so the visible viewport stays within world bounds; rendering applies a camera transform so the character stays near screen center.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "Structured world rendering (floor tiles, grid, obstacles)",
      "synonyms": [
        "TILE_REGIONS",
        "corridor floor rendering",
        "grid lines"
      ],
      "description": "Renders a corridor floor using predefined/generated tile regions, draws subtle horizontal grid lines for structure, and renders obstacles with distinct styles (walls as rectangles; rocks/trees as circles).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "Donald sprite loading with fallback character rendering",
      "synonyms": [
        "sprite asset loading",
        "imageLoaded/imageError",
        "pixel-art fallback silhouette"
      ],
      "description": "Loads the Donald pixel sprite and renders it with image smoothing disabled; if the asset fails to load, draws a pixel-art-like fallback character so gameplay remains visible.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Speech balloon UI with within-canvas horizontal clamping",
      "synonyms": [
        "SpeechBalloon clamping",
        "balloon tail"
      ],
      "description": "Renders an animated speech balloon positioned relative to the canvas and clamps its left offset to stay within the canvas width while keeping a tail aligned to the intended x coordinate.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Strictly linear 3-unit-wide downward corridor world map",
      "synonyms": [
        "linear corridor redesign",
        "3 map units wide (300px)",
        "downward-only (+Y) progression"
      ],
      "description": "The world map is redesigned into a narrow corridor of exactly 3 map units (300px) wide that progresses downward with gentle horizontal curves and no branches/side areas, guiding players along one route.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Procedural corridor map generation (bounds, floor, walls, interior obstacles)",
      "synonyms": [
        "worldMap.ts generation",
        "WORLD_BOUNDS calculation",
        "wall segments",
        "interior rocks/trees placements"
      ],
      "description": "Computes world bounds from the corridor centerline path, generates floor tile regions along the corridor, builds wall obstacles along both edges, and places interior rocks/trees relative to the path for variety.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Internet Identity authentication provider and hook (ICP)",
      "synonyms": [
        "InternetIdentityProvider",
        "AuthClient context",
        "login/logout"
      ],
      "description": "Provides a context-based authentication layer using @dfinity/auth-client, supporting identity restoration on reload, login/logout, delegation validity checks, and status flags for UI control.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "Identity-aware backend actor creation and caching via React Query",
      "synonyms": [
        "useActor",
        "actor factory",
        "principal-keyed caching"
      ],
      "description": "Creates an anonymous actor when unauthenticated or an identity-bound actor when authenticated; caches by principal and invalidates/refetches non-actor queries when the actor changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "App bootstrap with React Query + Internet Identity providers",
      "synonyms": [
        "main.tsx",
        "QueryClientProvider",
        "provider composition"
      ],
      "description": "Initializes a QueryClient and wraps the app with QueryClientProvider and InternetIdentityProvider before rendering the root App component.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "Tailwind theming with OKLCH tokens and pixel-art utilities",
      "synonyms": [
        "tailwind.config.js",
        "OKLCH CSS variables",
        "pixelated utility",
        "custom bounce animation"
      ],
      "description": "Tailwind is configured with OKLCH CSS-variable tokens for consistent theming, typography/container/animation plugins, and global CSS utilities for pixelated rendering and a custom bounce animation.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-27",
      "title": "Always-active keyboard controls in gameplay (no click-to-focus gating)",
      "synonyms": [
        "global controls",
        "remove canvas focus requirement",
        "always-on arrow keys"
      ],
      "description": "Gameplay keyboard input no longer requires clicking the canvas to activate; arrow keys and Space work without a separate focus/engagement gate.",
      "reqIds": [
        "AR-4"
      ],
      "version": 1
    },
    {
      "id": "IF-28",
      "title": "Gameplay view uses intro-style mood gradient background",
      "synonyms": [
        "shared background",
        "introBackground reuse",
        "game background gradient"
      ],
      "description": "The game screen reuses the same gradient/mood background styling used during the intro, providing a consistent visual backdrop behind the canvas.",
      "reqIds": [
        "AR-2"
      ],
      "version": 1
    },
    {
      "id": "IF-29",
      "title": "Minimal canvas presentation (border/frame removed)",
      "synonyms": [
        "remove canvas border",
        "no frame"
      ],
      "description": "The game canvas/view no longer renders with a visible border/frame around it.",
      "reqIds": [
        "AR-3"
      ],
      "version": 1
    },
    {
      "id": "IF-30",
      "title": "Gameplay HUD copy cleanup (removed “Follow Donald'y Journey”)",
      "synonyms": [
        "remove follow text",
        "HUD text removal"
      ],
      "description": "The extra “Follow Donald'y Journey” text has been removed from the game layout.",
      "reqIds": [
        "AR-5"
      ],
      "version": 1
    },
    {
      "id": "IF-31",
      "title": "Controls legend displayed under the canvas",
      "synonyms": [
        "controls list",
        "arrows + space instructions under canvas"
      ],
      "description": "The gameplay layout includes a small controls list (arrow keys movement, Space action) under the canvas.",
      "reqIds": [
        "AR-6"
      ],
      "version": 1
    },
    {
      "id": "IF-32",
      "title": "Gameplay collision/spawn fix to prevent immediate stuck state",
      "synonyms": [
        "fix stuck-on-spawn",
        "collision resolution fix",
        "spawn placement fix"
      ],
      "description": "Adjusted world/collision/spawn logic to prevent the player from starting overlapped with obstacles/walls and becoming unable to move.",
      "reqIds": [
        "AR-1"
      ],
      "version": 1
    },
    {
      "id": "IF-34",
      "title": "Removed gameplay descriptive narrative line under the game",
      "synonyms": [
        "remove \"Donald explores the landscape of his ambitions...\"",
        "game layout text cleanup"
      ],
      "description": "The gameplay layout no longer displays the descriptive text line “Donald explores the landscape of his ambitions…”.",
      "reqIds": [
        "AR-8"
      ],
      "version": 1
    },
    {
      "id": "IF-35",
      "title": "Rounded corners applied to the full game container (canvas + HUD/controls)",
      "synonyms": [
        "rounded game container",
        "rounded corners around canvas + UI"
      ],
      "description": "The game container now has clearly rounded corners applied to the entire module (canvas and accompanying HUD/controls), not just the canvas element.",
      "reqIds": [
        "AR-9"
      ],
      "version": 1
    },
    {
      "id": "IF-36",
      "title": "Path-first corridor generation with passability validation",
      "synonyms": [
        "passability.ts",
        "carve/validate lane",
        "guaranteed continuous path"
      ],
      "description": "Corridor generation was reworked to hard-guarantee a continuous passable top-to-bottom lane by generating/validating a walkable path first (passability checks), then decorating with walls/obstacles constrained to never block that guaranteed route.",
      "reqIds": [
        "AR-7"
      ],
      "version": 1
    },
    {
      "id": "IF-37",
      "title": "Gameplay controls remap: 'J' for jokes, Space for action animation",
      "synonyms": [
        "AR-10 controls update",
        "joke key J",
        "Space action/spin"
      ],
      "description": "Arrow keys remain movement controls; the random-joke speech balloon is triggered with the 'J' key, and Space is reserved for a character action animation (e.g., spin).",
      "reqIds": [
        "AR-10"
      ],
      "version": 1
    },
    {
      "id": "IF-39",
      "title": "Collectibles HUD with unique item tracking (0/7 + stars)",
      "synonyms": [
        "CollectiblesHud",
        "star counter",
        "unique collectibles"
      ],
      "description": "Adds a top-of-container HUD that tracks uniquely collected items (7 total), rendering gold/yellow star indicators and a counter (e.g., \"0 / 7\"). Each collectible can only be collected once.",
      "reqIds": [
        "AR-12"
      ],
      "version": 1
    },
    {
      "id": "IF-40",
      "title": "First-movement goals modal (0.2s delayed)",
      "synonyms": [
        "GoalsModal delay 0.2s",
        "first movement trigger timing"
      ],
      "description": "In gameplay, after the first detected player movement input, a goals prompt/modal is shown after a 0.2s delay displaying the provided Donald goals title/body text.",
      "reqIds": [
        "AR-16"
      ],
      "version": 1
    },
    {
      "id": "IF-41",
      "title": "Collectibles HUD positioned top-right with no border",
      "synonyms": [
        "CollectiblesHud top-right",
        "borderless HUD"
      ],
      "description": "The collectibles HUD is rendered in the top-right of the game container and uses a borderless visual style.",
      "reqIds": [
        "AR-13"
      ],
      "version": 1
    },
    {
      "id": "IF-42",
      "title": "Space-gated star pickup interaction with proximity requirement",
      "synonyms": [
        "press Space to pick up",
        "near-star pickup",
        "pickup priority over action"
      ],
      "description": "Collectibles/stars are only picked up when the player presses Space while within a close proximity radius of the star; Space still performs the action animation, with pickup handled when in range.",
      "reqIds": [
        "AR-15"
      ],
      "version": 1
    },
    {
      "id": "IF-43",
      "title": "World/map scaled to ~2.5× height while keeping corridor width unchanged",
      "synonyms": [
        "map scaling 2.5x",
        "longer corridor"
      ],
      "description": "The corridor world height/length is expanded to approximately 2.5× the prior size while keeping the corridor width unchanged.",
      "reqIds": [
        "AR-14"
      ],
      "version": 1
    },
    {
      "id": "IF-44",
      "title": "Star pickup sound effect feedback",
      "synonyms": [
        "pickup SFX",
        "useSfx hook"
      ],
      "description": "A sound effect is played when a star/collectible is successfully picked up.",
      "reqIds": [
        "AR-17"
      ],
      "version": 1
    },
    {
      "id": "feature-adjust-collectible-generation-so-that-the-first-collectible-star-the-player-encounters-is-placed-meaningfully-farther-from-the-player-spawn-position-so-it-is-not-reachable-immediately-after-starting-the-game",
      "title": "Adjust collectible generation so that the first collectible star the player encounters is placed meaningfully farther from the player spawn position, so it is not reachable immediately after starting the game.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-gameplay-controls-legend-text-under-the-canvas-to-change-the-phrase-space-to-act-collect-stars-to-space-to-act",
      "title": "Update the gameplay controls legend text under the canvas to change the phrase “Space to act & collect stars” to “Space to act”.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-18",
      "summary": "Move the first collectible star further away from the player starting point",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Update controls legend text to change “Space to act & collect stars” to “Space to act”",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "architectural_notes": [
    "React + TypeScript SPA with feature-based organization (src/features/intro, src/features/game) and centralized story content (src/content/story.ts).",
    "IntroFlow is implemented as an explicit stage/state machine (FlowStage union) coordinated by multiple useEffect timers for line-by-line reveals and gated progression.",
    "Intro mood progression uses OKLCH-based CSS gradients computed in a helper (getBackgroundGradient) and crossfaded via layered full-screen divs with opacity transitions.",
    "Gameplay rendering is imperative Canvas2D drawing inside a React component; simulation runs in a requestAnimationFrame loop (useGameLoop) with deltaTime in seconds for frame-rate-independent movement.",
    "Per-frame gameplay state (character position, camera position) is stored in refs to avoid React re-renders; React state is reserved for UI overlays (joke balloon) and asset-load status.",
    "Keyboard input is encapsulated in a hook (useKeyboardControls) that gates controls behind a canvas focus concept and uses window-level key listeners.",
    "World geometry (bounds, floor tile regions, obstacles) and physics helpers (clamping, collision) are separated into a dedicated module (worldMap.ts); corridor floor/walls are generated procedurally from a centerline path definition.",
    "Styling uses Tailwind CSS with OKLCH token theming, tailwindcss-animate, and shadcn/ui primitives (Button, Slider).",
    "ICP scaffolding: InternetIdentityProvider wraps @dfinity/auth-client; useActor creates/caches an anonymous or identity-bound backend actor using TanStack React Query and invalidates/refetches non-actor queries when the actor changes.",
    "Repository now includes a build-template/ scaffold for ICP projects: canister YAMLs, deploy/build scripts, frontend tooling (Vite/Tailwind), shadcn/ui component library sources, and custom ESLint rules to enforce Internet Identity provider usage and safe React Query key patterns.",
    "Gameplay input handling has been simplified so keyboard controls are always active, removing the prior canvas-focus gating concept in useKeyboardControls/GameView.",
    "GameView now reuses the intro background/gradient system to provide consistent mood styling behind the canvas UI.",
    "Corridor/obstacle generation must guarantee at least one continuous passable path forward (no full-width impassable walling).",
    "Gameplay layout: the removable descriptive text (“Donald explores the landscape of his ambitions…”) is located below the game container; rounded corners should apply to the entire game container (canvas + HUD/controls), clearly rounded.",
    "Corridor wall/obstacle placement is constrained to ensure forward progress by enforcing openings/gaps and preventing any full-width impassable segments in the 3-unit corridor.",
    "Gameplay layout no longer includes the extra descriptive narrative line beneath the game view; the container styling was updated so rounded corners wrap the entire game module (canvas + HUD/controls).",
    "Corridor generation should use a path-first approach (carve/validate a continuous passable lane from start to end) and only then decorate with obstacles constrained not to block that guaranteed path; acceptable to rework the generator rather than patching with ad-hoc checks.",
    "Corridor generation now follows a path-first approach: carve/validate a continuous passable lane, then place walls/obstacles with constraints so they cannot block the validated path (supported by a dedicated passability module).",
    "Gameplay input mapping updated: jokes are triggered by 'J'; Space is used for a character action animation; movement remains Arrow keys.",
    "Introduce gameplay progression UI: trigger a modal 0.5s after the first detected player movement input; add a HUD that tracks a set of uniquely collected items (7 total) and renders a 0/7 counter plus star indicators.",
    "Collectibles HUD implemented as a dedicated component that tracks unique collectible pickups (7 total) and renders star indicators plus a 0/7 counter.",
    "Star/collectible pickup should be input-gated: pressing Space while within a proximity radius triggers pickup; consider prioritizing pickup over the Space action animation when in range.",
    "Map scaling clarification: expand world height only by ~2.5× while keeping corridor width unchanged.",
    "Star pickup interaction clarification: require Space press when almost touching a star; Space should both trigger pickup (when in range) and still perform the action animation.",
    "First-movement GoalsModal timing updated: trigger after 0.2s (was 0.5s).",
    "Add SFX hook/asset for star pickup feedback sound.",
    "Collectibles HUD UI is positioned top-right and rendered borderless within the rounded game container.",
    "Collectible pickup logic is input-gated: pressing Space while within a tight proximity triggers pickup; Space continues to also trigger the action animation when used.",
    "World scaling updated to extend corridor/world height by ~2.5× while keeping corridor width unchanged.",
    "Star pickup plays an SFX; audio/sfx behavior is encapsulated via a small hook/utility and triggered on successful pickup."
  ],
  "known_issues": [
    "Camera clamping assumes world bounds are larger than the viewport; with a corridor world that can be narrower than the 500px canvas, horizontal camera clamping can collapse to a constant value (camera X becomes effectively fixed).",
    "Backend canister (backend/main.mo) is an empty actor with no methods; the auth/actor scaffolding currently has no functional backend API to call.",
    "Duplicate/global CSS entrypoints exist (frontend/index.css and frontend/src/index.css); only src/index.css is imported by the app, but the extra file can confuse maintenance."
  ],
  "isFixRequest": false,
  "gameProjectType": "2d",
  "projectName": "Story-based goal-setting game intro flow + vertical-scrolling 2D segment with jokes",
  "clarification_mode": "pro",
  "clarification_rounds": 0
}